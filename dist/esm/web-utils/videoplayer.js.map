{"version":3,"file":"videoplayer.js","sourceRoot":"","sources":["../../../src/web-utils/videoplayer.ts"],"names":[],"mappings":"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","sourcesContent":["import Hls from 'hls.js';\r\n\r\nimport type { videoMimeType } from './video-types';\r\nimport { videoTypes, possibleQueryParameterExtensions } from './video-types';\r\n\r\nexport class VideoPlayer {\r\n  public videoEl: HTMLVideoElement | undefined;\r\n  public pipMode = false;\r\n  public pipWindow: Window | undefined;\r\n  public isPlaying: boolean | undefined;\r\n\r\n  private _url: string;\r\n  private _playerId: string;\r\n  private _container: any;\r\n  private _mode: string;\r\n  private _width: number;\r\n  private _height: number;\r\n  private _zIndex: number;\r\n  private _initial: any;\r\n  private _videoType: videoMimeType | null = null;\r\n  private _videoContainer: any = null;\r\n  private _firstReadyToPlay = true;\r\n  private _isEnded = false;\r\n  private _videoRate = 1.0;\r\n  private _videoExitOnEnd = true;\r\n  private _videoLoopOnEnd = false;\r\n\r\n  constructor(\r\n    mode: string,\r\n    url: string,\r\n    playerId: string,\r\n    rate: number,\r\n    exitOnEnd: boolean,\r\n    loopOnEnd: boolean,\r\n    container: any,\r\n    zIndex: number,\r\n    width?: number,\r\n    height?: number,\r\n  ) {\r\n    this._url = url;\r\n    this._container = container;\r\n    this._mode = mode;\r\n    this._width = width ? width : 320;\r\n    this._height = height ? height : 180;\r\n    this._mode = mode;\r\n    this._videoRate = rate;\r\n    this._zIndex = zIndex ? zIndex : 1;\r\n    this._playerId = playerId;\r\n    this._videoExitOnEnd = exitOnEnd;\r\n    this._videoLoopOnEnd = loopOnEnd;\r\n  }\r\n\r\n  public async initialize(): Promise<void> {\r\n    // get the video type\r\n    const urlVideoType: videoMimeType | null = this._getVideoType();\r\n    if (urlVideoType) {\r\n      // style the container\r\n      if (this._mode === 'fullscreen') {\r\n        this._container.style.position = 'absolute';\r\n        this._container.style.width = '100vw';\r\n        this._container.style.height = '100vh';\r\n      }\r\n      if (this._mode === 'embedded') {\r\n        this._container.style.position = 'relative';\r\n        this._container.style.width = this._width.toString() + 'px';\r\n        this._container.style.height = this._height.toString() + 'px';\r\n      }\r\n      this._container.style.left = '0';\r\n      this._container.style.top = '0';\r\n      this._container.style.display = 'flex';\r\n      this._container.style.alignItems = 'center';\r\n      this._container.style.justifyContent = 'center';\r\n      this._container.style.backgroundColor = '#000000';\r\n      this._container.style.zIndex = this._zIndex.toString();\r\n      const width: number =\r\n        this._mode === 'fullscreen' ? window.innerWidth /*this._container.offsetWidth*/ : this._width;\r\n      const height: number =\r\n        this._mode === 'fullscreen' ? window.innerHeight /*this._container.offsetHeight*/ : this._height;\r\n      const xmlns = 'http://www.w3.org/2000/svg';\r\n\r\n      const svg = document.createElementNS(xmlns, 'svg');\r\n      svg.setAttributeNS(null, 'width', width.toString());\r\n      svg.setAttributeNS(null, 'height', height.toString());\r\n      const viewbox = '0 0 ' + width.toString() + ' ' + height.toString();\r\n      svg.setAttributeNS(null, 'viewBox', viewbox);\r\n      svg.style.zIndex = (this._zIndex + 1).toString();\r\n      const rect = document.createElementNS(xmlns, 'rect');\r\n      rect.setAttributeNS(null, 'x', '0');\r\n      rect.setAttributeNS(null, 'y', '0');\r\n      rect.setAttributeNS(null, 'width', width.toString());\r\n      rect.setAttributeNS(null, 'height', height.toString());\r\n      rect.setAttributeNS(null, 'fill', '#000000');\r\n      svg.appendChild(rect);\r\n      this._container.appendChild(svg);\r\n\r\n      const heightVideo: number = (width * this._height) / this._width;\r\n      this._videoContainer = document.createElement('div');\r\n      this._videoContainer.style.position = 'absolute';\r\n      this._videoContainer.style.left = '0';\r\n      this._videoContainer.style.width = width.toString() + 'px';\r\n      this._videoContainer.style.height = heightVideo.toString() + 'px';\r\n      this._videoContainer.style.zIndex = (this._zIndex + 2).toString();\r\n      this._container.appendChild(this._videoContainer);\r\n      /*   Create Video Element */\r\n      const isCreated = await this.createVideoElement(width, heightVideo);\r\n      if (!isCreated) {\r\n        this._createEvent('Exit', this._playerId, 'Video Error: failed to create the Video Element');\r\n      }\r\n    } else {\r\n      this._createEvent('Exit', this._playerId, 'Url Error: type not supported');\r\n    }\r\n    return;\r\n  }\r\n\r\n  private async createVideoElement(width: number, height: number): Promise<boolean> {\r\n    this.videoEl = document.createElement('video');\r\n    this.videoEl.controls = true;\r\n    this.videoEl.style.zIndex = (this._zIndex + 3).toString();\r\n    this.videoEl.style.width = `${width.toString()}px`;\r\n    this.videoEl.style.height = `${height.toString()}px`;\r\n    this.videoEl.playbackRate = this._videoRate;\r\n    this._videoContainer.appendChild(this.videoEl);\r\n    // set the player\r\n    const isSet: boolean = await this._setPlayer();\r\n    if (isSet) {\r\n      this.videoEl.onended = async () => {\r\n        this._isEnded = true;\r\n        this.isPlaying = false;\r\n        if (this.videoEl) {\r\n          this.videoEl.currentTime = 0;\r\n        }\r\n        if (this._videoExitOnEnd) {\r\n          if (this._mode === 'fullscreen') {\r\n            this._closeFullscreen();\r\n          }\r\n          this._createEvent('Ended', this._playerId);\r\n        } else {\r\n          if (this._videoLoopOnEnd && this.videoEl != null) {\r\n            await this.videoEl.play();\r\n          }\r\n        }\r\n      };\r\n      this.videoEl.oncanplay = async () => {\r\n        if (this._firstReadyToPlay) {\r\n          this._createEvent('Ready', this._playerId);\r\n          if (this.videoEl != null) {\r\n            this.videoEl.muted = false;\r\n            if (this._mode === 'fullscreen') await this.videoEl.play();\r\n            this._firstReadyToPlay = false;\r\n          }\r\n        }\r\n      };\r\n      this.videoEl.onplay = () => {\r\n        this.isPlaying = true;\r\n        if (this._firstReadyToPlay) this._firstReadyToPlay = false;\r\n        this._createEvent('Play', this._playerId);\r\n      };\r\n      this.videoEl.onplaying = () => {\r\n        this._createEvent('Playing', this._playerId);\r\n      };\r\n      this.videoEl.onpause = () => {\r\n        this.isPlaying = false;\r\n        this._createEvent('Pause', this._playerId);\r\n      };\r\n      if (this._mode === 'fullscreen') {\r\n        // create the video player exit button\r\n        const exitEl: HTMLButtonElement = document.createElement('button');\r\n        exitEl.textContent = 'X';\r\n        exitEl.style.position = 'absolute';\r\n        exitEl.style.left = '1%';\r\n        exitEl.style.top = '5%';\r\n        exitEl.style.width = '5vmin';\r\n        exitEl.style.padding = '0.5%';\r\n        exitEl.style.fontSize = '1.2rem';\r\n        exitEl.style.background = 'rgba(51,51,51,.4)';\r\n        exitEl.style.color = '#fff';\r\n        exitEl.style.visibility = 'hidden';\r\n        exitEl.style.zIndex = (this._zIndex + 4).toString();\r\n        exitEl.style.border = '1px solid rgba(51,51,51,.4)';\r\n        exitEl.style.borderRadius = '20px';\r\n        this._videoContainer.onclick = async () => {\r\n          this._initial = await this._doHide(exitEl, 3000);\r\n        };\r\n        this._videoContainer.ontouchstart = async () => {\r\n          this._initial = await this._doHide(exitEl, 3000);\r\n        };\r\n\r\n        this._videoContainer.onmousemove = async () => {\r\n          this._initial = await this._doHide(exitEl, 3000);\r\n        };\r\n\r\n        exitEl.onclick = () => {\r\n          this._createEvent('Exit', this._playerId);\r\n        };\r\n        exitEl.ontouchstart = () => {\r\n          this._createEvent('Exit', this._playerId);\r\n        };\r\n\r\n        this._videoContainer.appendChild(exitEl);\r\n        this._initial = await this._doHide(exitEl, 3000);\r\n\r\n        this._goFullscreen();\r\n      }\r\n    }\r\n    return isSet;\r\n  }\r\n\r\n  private async _goFullscreen(): Promise<void> {\r\n    if (this._container.mozRequestFullScreen) {\r\n      /* Firefox */\r\n      this._container.mozRequestFullScreen();\r\n    } else if (this._container.webkitRequestFullscreen) {\r\n      /* Chrome, Safari & Opera */\r\n      this._container.webkitRequestFullscreen();\r\n    } else if (this._container.msRequestFullscreen) {\r\n      /* IE/Edge */\r\n      this._container.msRequestFullscreen();\r\n    } else if (this._container.requestFullscreen) {\r\n      this._container.requestFullscreen();\r\n    }\r\n    return;\r\n  }\r\n\r\n  private async _setPlayer(): Promise<boolean> {\r\n    return new Promise((resolve) => {\r\n      if (this.videoEl != null) {\r\n        if (Hls.isSupported() && this._videoType === 'application/x-mpegURL') {\r\n          const hls = new Hls();\r\n          hls.loadSource(this._url);\r\n          hls.attachMedia(this.videoEl);\r\n          hls.once(Hls.Events.FRAG_PARSED, () => {\r\n            if (this.videoEl != null) {\r\n              this.videoEl.muted = true;\r\n              this.videoEl.crossOrigin = 'anonymous';\r\n              resolve(true);\r\n            } else {\r\n              resolve(false);\r\n            }\r\n          });\r\n        } else if (this._videoType === 'video/mp4') {\r\n          // CMAF (fMP4) && MP4\r\n          this.videoEl.src = this._url;\r\n          if (this._url.substring(0, 5) != 'https' && this._url.substring(0, 4) === 'http')\r\n            this.videoEl.crossOrigin = 'anonymous';\r\n          if (this._url.substring(0, 5) === 'https' || this._url.substring(0, 4) === 'http') this.videoEl.muted = true;\r\n          resolve(true);\r\n        } else {\r\n          // Not Supported\r\n          resolve(false);\r\n        }\r\n        this.videoEl.addEventListener('enterpictureinpicture', (event: any) => {\r\n          this.pipWindow = event.pictureInPictureWindow;\r\n          this.pipMode = true;\r\n          this._closeFullscreen();\r\n        });\r\n\r\n        this.videoEl.addEventListener('leavepictureinpicture', () => {\r\n          this.pipMode = false;\r\n          if (!this._isEnded) {\r\n            this._goFullscreen();\r\n            if (this.videoEl != null) this.videoEl.play();\r\n          }\r\n        });\r\n      } else {\r\n        resolve(false);\r\n      }\r\n    });\r\n  }\r\n\r\n  private _getVideoType(): videoMimeType | null {\r\n    const sUrl: string = this._url ? this._url : '';\r\n    if (sUrl != null && sUrl.length > 0) {\r\n      Object.entries(videoTypes).forEach(([extension, mimeType]) => {\r\n        // we search for dot + extension (e.g. `.mp4`) for URLs that have the extension in the filename\r\n        // e.g. https://vimeo.com/?file=my-video.mp4\r\n        const hasDotExtension = sUrl.match(new RegExp(`.(${extension})`, 'i'));\r\n        if (hasDotExtension) {\r\n          return (this._videoType = mimeType);\r\n        }\r\n        // we search for the extension (e.g. `m3u8`) for URLs that might have the extension as a query parameter\r\n        // e.g. https://youtube.com/?v=7894289374&type=m3u8\r\n        const hasExtensionInUrl = sUrl.match(new RegExp(`(${extension})`, 'i'));\r\n        if (hasExtensionInUrl) {\r\n          return (this._videoType = mimeType);\r\n        }\r\n      });\r\n      // we check for not supported extensions for URLs that have the extension in the filename\r\n      // e.g. https://vimeo.com/?file=not-supported-extension-video.mkv\r\n      const hasNotSupportedDotExtension = sUrl.match(/\\.(.*)/i);\r\n      if (hasNotSupportedDotExtension) {\r\n        return (this._videoType = null);\r\n      }\r\n      // we check for not supported extensions for URLs that might have the extension as a query parameter\r\n      // e.g. https://youtube.com/?v=3982748927&filetype=mkv\r\n      const hasNotSupportedExtensionInUrl = sUrl.match(\r\n        new RegExp(`(${possibleQueryParameterExtensions.join('|')})=+(.*)&?(?=&|$))`, 'i'),\r\n      );\r\n      if (hasNotSupportedExtensionInUrl) {\r\n        return (this._videoType = null);\r\n      }\r\n      // No extension found, then we assume it's 'mp4' (Match case for '')\r\n      return 'video/mp4';\r\n    }\r\n    // URL was not defined, we return null\r\n    return null;\r\n  }\r\n\r\n  private async _doHide(exitEl: HTMLButtonElement, duration: number) {\r\n    clearTimeout(this._initial);\r\n    exitEl.style.visibility = 'visible';\r\n    const initial = setTimeout(() => {\r\n      exitEl.style.visibility = 'hidden';\r\n    }, duration);\r\n    return initial;\r\n  }\r\n  private _createEvent(ev: string, playerId: string, msg?: string) {\r\n    const message = msg ? msg : null;\r\n    let event: CustomEvent;\r\n    if (message != null) {\r\n      event = new CustomEvent(`videoPlayer${ev}`, {\r\n        detail: { fromPlayerId: playerId, message: message },\r\n      });\r\n    } else {\r\n      const currentTime: number = this.videoEl ? this.videoEl.currentTime : 0;\r\n      event = new CustomEvent(`videoPlayer${ev}`, {\r\n        detail: { fromPlayerId: playerId, currentTime: currentTime },\r\n      });\r\n    }\r\n    document.dispatchEvent(event);\r\n  }\r\n  private _closeFullscreen() {\r\n    const mydoc: any = document;\r\n    const isInFullScreen: boolean =\r\n      (mydoc.fullscreenElement && mydoc.fullscreenElement !== null) ||\r\n      (mydoc.webkitFullscreenElement && mydoc.webkitFullscreenElement !== null) ||\r\n      (mydoc.mozFullScreenElement && mydoc.mozFullScreenElement !== null) ||\r\n      (mydoc.msFullscreenElement && mydoc.msFullscreenElement !== null);\r\n    if (isInFullScreen) {\r\n      if (mydoc.mozCancelFullScreen) {\r\n        mydoc.mozCancelFullScreen();\r\n      } else if (mydoc.webkitExitFullscreen) {\r\n        mydoc.webkitExitFullscreen();\r\n      } else if (mydoc.msExitFullscreen) {\r\n        mydoc.msExitFullscreen();\r\n      } else if (mydoc.exitFullscreen) {\r\n        mydoc.exitFullscreen();\r\n      }\r\n    }\r\n  }\r\n}\r\n"]}